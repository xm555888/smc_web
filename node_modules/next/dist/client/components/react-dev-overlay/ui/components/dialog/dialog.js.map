{"version":3,"sources":["../../../../../../../src/client/components/react-dev-overlay/ui/components/dialog/dialog.tsx"],"sourcesContent":["import * as React from 'react'\nimport { useOnClickOutside } from '../../hooks/use-on-click-outside'\nimport { useMeasureHeight } from '../../hooks/use-measure-height'\n\nexport type DialogProps = {\n  children?: React.ReactNode\n  type: 'error' | 'warning'\n  'aria-labelledby': string\n  'aria-describedby': string\n  className?: string\n  onClose?: () => void\n  dialogResizerRef?: React.RefObject<HTMLDivElement | null>\n}\n\nconst CSS_SELECTORS_TO_EXCLUDE_ON_CLICK_OUTSIDE = [\n  '[data-next-mark]',\n  '[data-issues-open]',\n  '#nextjs-dev-tools-menu',\n  '[data-nextjs-error-overlay-nav]',\n  '[data-info-popover]',\n]\n\nconst Dialog: React.FC<DialogProps> = function Dialog({\n  children,\n  type,\n  className,\n  onClose,\n  'aria-labelledby': ariaLabelledBy,\n  'aria-describedby': ariaDescribedBy,\n  dialogResizerRef,\n  ...props\n}) {\n  const [dialog, setDialog] = React.useState<HTMLDivElement | null>(null)\n  const [role, setRole] = React.useState<string | undefined>(\n    typeof document !== 'undefined' && document.hasFocus()\n      ? 'dialog'\n      : undefined\n  )\n\n  const ref = React.useRef<HTMLDivElement | null>(null)\n  const [height, pristine] = useMeasureHeight(ref)\n\n  const onDialog = React.useCallback((node: HTMLDivElement | null) => {\n    setDialog(node)\n  }, [])\n\n  useOnClickOutside(dialog, CSS_SELECTORS_TO_EXCLUDE_ON_CLICK_OUTSIDE, (e) => {\n    e.preventDefault()\n    return onClose?.()\n  })\n\n  React.useEffect(() => {\n    if (dialog == null) {\n      return\n    }\n\n    function handleFocus() {\n      // safari will force itself as the active application when a background page triggers any sort of autofocus\n      // this is a workaround to only set the dialog role if the document has focus\n      setRole(document.hasFocus() ? 'dialog' : undefined)\n    }\n\n    window.addEventListener('focus', handleFocus)\n    window.addEventListener('blur', handleFocus)\n    return () => {\n      window.removeEventListener('focus', handleFocus)\n      window.removeEventListener('blur', handleFocus)\n    }\n  }, [dialog])\n\n  React.useEffect(() => {\n    const root = dialog?.getRootNode()\n    const activeElement =\n      root instanceof ShadowRoot ? (root?.activeElement as HTMLElement) : null\n\n    // Trap focus within the dialog\n    dialog?.focus()\n\n    return () => {\n      // Blur first to avoid getting stuck, in case `activeElement` is missing\n      dialog?.blur()\n      // Restore focus to the previously active element\n      activeElement?.focus()\n    }\n  }, [dialog])\n\n  return (\n    <div\n      ref={onDialog}\n      data-nextjs-dialog\n      tabIndex={1}\n      role={role}\n      aria-labelledby={ariaLabelledBy}\n      aria-describedby={ariaDescribedBy}\n      aria-modal=\"true\"\n      className={className}\n      onKeyDown={(e) => {\n        if (e.key === 'Escape') {\n          onClose?.()\n        }\n      }}\n      {...props}\n    >\n      <div\n        ref={dialogResizerRef}\n        data-nextjs-dialog-sizer\n        // [x] Don't animate on initial load\n        // [x] No duplicate elements\n        // [x] Responds to content growth\n        style={{\n          height,\n          transition: pristine ? undefined : 'height 250ms var(--timing-swift)',\n        }}\n      >\n        <div ref={ref}>{children}</div>\n      </div>\n    </div>\n  )\n}\n\nexport { Dialog }\n"],"names":["Dialog","CSS_SELECTORS_TO_EXCLUDE_ON_CLICK_OUTSIDE","children","type","className","onClose","ariaLabelledBy","ariaDescribedBy","dialogResizerRef","props","dialog","setDialog","React","useState","role","setRole","document","hasFocus","undefined","ref","useRef","height","pristine","useMeasureHeight","onDialog","useCallback","node","useOnClickOutside","e","preventDefault","useEffect","handleFocus","window","addEventListener","removeEventListener","root","getRootNode","activeElement","ShadowRoot","focus","blur","div","data-nextjs-dialog","tabIndex","aria-labelledby","aria-describedby","aria-modal","onKeyDown","key","data-nextjs-dialog-sizer","style","transition"],"mappings":";;;;+BAwHSA;;;eAAAA;;;;;iEAxHc;mCACW;kCACD;AAYjC,MAAMC,4CAA4C;IAChD;IACA;IACA;IACA;IACA;CACD;AAED,MAAMD,SAAgC,SAASA,OAAO,KASrD;IATqD,IAAA,EACpDE,QAAQ,EACRC,IAAI,EACJC,SAAS,EACTC,OAAO,EACP,mBAAmBC,cAAc,EACjC,oBAAoBC,eAAe,EACnCC,gBAAgB,EAChB,GAAGC,OACJ,GATqD;IAUpD,MAAM,CAACC,QAAQC,UAAU,GAAGC,OAAMC,QAAQ,CAAwB;IAClE,MAAM,CAACC,MAAMC,QAAQ,GAAGH,OAAMC,QAAQ,CACpC,OAAOG,aAAa,eAAeA,SAASC,QAAQ,KAChD,WACAC;IAGN,MAAMC,MAAMP,OAAMQ,MAAM,CAAwB;IAChD,MAAM,CAACC,QAAQC,SAAS,GAAGC,IAAAA,kCAAgB,EAACJ;IAE5C,MAAMK,WAAWZ,OAAMa,WAAW,CAAC,CAACC;QAClCf,UAAUe;IACZ,GAAG,EAAE;IAELC,IAAAA,oCAAiB,EAACjB,QAAQT,2CAA2C,CAAC2B;QACpEA,EAAEC,cAAc;QAChB,OAAOxB,2BAAAA;IACT;IAEAO,OAAMkB,SAAS,CAAC;QACd,IAAIpB,UAAU,MAAM;YAClB;QACF;QAEA,SAASqB;YACP,2GAA2G;YAC3G,6EAA6E;YAC7EhB,QAAQC,SAASC,QAAQ,KAAK,WAAWC;QAC3C;QAEAc,OAAOC,gBAAgB,CAAC,SAASF;QACjCC,OAAOC,gBAAgB,CAAC,QAAQF;QAChC,OAAO;YACLC,OAAOE,mBAAmB,CAAC,SAASH;YACpCC,OAAOE,mBAAmB,CAAC,QAAQH;QACrC;IACF,GAAG;QAACrB;KAAO;IAEXE,OAAMkB,SAAS,CAAC;QACd,MAAMK,OAAOzB,0BAAAA,OAAQ0B,WAAW;QAChC,MAAMC,gBACJF,gBAAgBG,aAAcH,wBAAAA,KAAME,aAAa,GAAmB;QAEtE,+BAA+B;QAC/B3B,0BAAAA,OAAQ6B,KAAK;QAEb,OAAO;YACL,wEAAwE;YACxE7B,0BAAAA,OAAQ8B,IAAI;YACZ,iDAAiD;YACjDH,iCAAAA,cAAeE,KAAK;QACtB;IACF,GAAG;QAAC7B;KAAO;IAEX,qBACE,qBAAC+B;QACCtB,KAAKK;QACLkB,oBAAkB;QAClBC,UAAU;QACV7B,MAAMA;QACN8B,mBAAiBtC;QACjBuC,oBAAkBtC;QAClBuC,cAAW;QACX1C,WAAWA;QACX2C,WAAW,CAACnB;YACV,IAAIA,EAAEoB,GAAG,KAAK,UAAU;gBACtB3C,2BAAAA;YACF;QACF;QACC,GAAGI,KAAK;kBAET,cAAA,qBAACgC;YACCtB,KAAKX;YACLyC,0BAAwB;YACxB,oCAAoC;YACpC,4BAA4B;YAC5B,iCAAiC;YACjCC,OAAO;gBACL7B;gBACA8B,YAAY7B,WAAWJ,YAAY;YACrC;sBAEA,cAAA,qBAACuB;gBAAItB,KAAKA;0BAAMjB;;;;AAIxB"}