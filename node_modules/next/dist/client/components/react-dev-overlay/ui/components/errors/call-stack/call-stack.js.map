{"version":3,"sources":["../../../../../../../../src/client/components/react-dev-overlay/ui/components/errors/call-stack/call-stack.tsx"],"sourcesContent":["import type { OriginalStackFrame } from '../../../../utils/stack-frame'\nimport { useMemo, useState, useRef } from 'react'\nimport { CallStackFrame } from '../../call-stack-frame/call-stack-frame'\n\ninterface CallStackProps {\n  frames: OriginalStackFrame[]\n  dialogResizerRef: React.RefObject<HTMLDivElement | null>\n}\n\nexport function CallStack({ frames, dialogResizerRef }: CallStackProps) {\n  const initialDialogHeight = useRef<number>(NaN)\n  const [isIgnoreListOpen, setIsIgnoreListOpen] = useState(false)\n\n  const { visibleFrames, ignoredFrames, ignoreListLength } = useMemo(() => {\n    const visible: OriginalStackFrame[] = []\n    const ignored: OriginalStackFrame[] = []\n\n    for (const frame of frames) {\n      if (!frame.ignored) {\n        visible.push(frame)\n      }\n      if (frame.ignored) {\n        ignored.push(frame)\n      }\n    }\n\n    return {\n      visibleFrames: visible,\n      ignoredFrames: ignored,\n      ignoreListLength: ignored.length,\n    }\n  }, [frames])\n\n  function onToggleIgnoreList() {\n    const dialog = dialogResizerRef?.current as HTMLElement\n\n    if (!dialog) {\n      return\n    }\n\n    const { height: currentHeight } = dialog?.getBoundingClientRect()\n\n    if (!initialDialogHeight.current) {\n      initialDialogHeight.current = currentHeight\n    }\n\n    if (isIgnoreListOpen) {\n      function onTransitionEnd() {\n        dialog.removeEventListener('transitionend', onTransitionEnd)\n        setIsIgnoreListOpen(false)\n      }\n      dialog.style.height = `${initialDialogHeight.current}px`\n      dialog.addEventListener('transitionend', onTransitionEnd)\n    } else {\n      setIsIgnoreListOpen(true)\n    }\n  }\n\n  return (\n    <div className=\"error-overlay-call-stack-container\">\n      <div className=\"error-overlay-call-stack-header\">\n        <p className=\"error-overlay-call-stack-title\">\n          Call Stack{' '}\n          <span className=\"error-overlay-call-stack-count\">\n            {frames.length}\n          </span>\n        </p>\n        {ignoreListLength > 0 && (\n          <button\n            data-expand-ignore-button={isIgnoreListOpen}\n            className=\"error-overlay-call-stack-ignored-list-toggle-button\"\n            onClick={onToggleIgnoreList}\n          >\n            {`${isIgnoreListOpen ? 'Hide' : 'Show'} ${ignoreListLength} ignore-listed frames`}\n            <ChevronUpDown />\n          </button>\n        )}\n      </div>\n      {visibleFrames.map((frame, frameIndex) => (\n        <CallStackFrame\n          key={`call-stack-leading-${frameIndex}`}\n          frame={frame}\n          index={frameIndex}\n        />\n      ))}\n\n      {isIgnoreListOpen && (\n        <>\n          {ignoredFrames.map((frame, frameIndex) => (\n            <CallStackFrame\n              key={`call-stack-ignored-${frameIndex}`}\n              frame={frame}\n              index={frameIndex}\n            />\n          ))}\n        </>\n      )}\n    </div>\n  )\n}\n\nfunction ChevronUpDown() {\n  return (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M8.70722 2.39641C8.3167 2.00588 7.68353 2.00588 7.29301 2.39641L4.46978 5.21963L3.93945 5.74996L5.00011 6.81062L5.53044 6.28029L8.00011 3.81062L10.4698 6.28029L11.0001 6.81062L12.0608 5.74996L11.5304 5.21963L8.70722 2.39641ZM5.53044 9.71963L5.00011 9.1893L3.93945 10.25L4.46978 10.7803L7.29301 13.6035C7.68353 13.994 8.3167 13.994 8.70722 13.6035L11.5304 10.7803L12.0608 10.25L11.0001 9.1893L10.4698 9.71963L8.00011 12.1893L5.53044 9.71963Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  )\n}\n\nexport const CALL_STACK_STYLES = `\n  .error-overlay-call-stack-container {\n    position: relative;\n    margin-top: 8px;\n  }\n\n  .error-overlay-call-stack-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    min-height: var(--size-28);\n    padding: 8px 8px 12px 4px;\n    width: 100%;\n  }\n\n  .error-overlay-call-stack-title {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 8px;\n\n    margin: 0;\n\n    color: var(--color-gray-1000);\n    font-size: var(--size-16);\n    font-weight: 500;\n  }\n\n  .error-overlay-call-stack-count {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n\n    width: var(--size-20);\n    height: var(--size-20);\n    gap: 4px;\n\n    color: var(--color-gray-1000);\n    text-align: center;\n    font-size: var(--size-11);\n    font-weight: 500;\n    line-height: var(--size-16);\n\n    border-radius: var(--rounded-full);\n    background: var(--color-gray-300);\n  }\n\n  .error-overlay-call-stack-ignored-list-toggle-button {\n    all: unset;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    color: var(--color-gray-900);\n    font-size: var(--size-14);\n    line-height: var(--size-20);\n    border-radius: 6px;\n    padding: 4px 6px;\n    margin-right: -6px;\n    transition: background 150ms ease;\n\n    &:hover {\n      background: var(--color-gray-100);\n    }\n\n    &:focus {\n      outline: var(--focus-ring);\n    }\n\n    svg {\n      width: var(--size-16);\n      height: var(--size-16);\n    }\n  }\n`\n"],"names":["CALL_STACK_STYLES","CallStack","frames","dialogResizerRef","initialDialogHeight","useRef","NaN","isIgnoreListOpen","setIsIgnoreListOpen","useState","visibleFrames","ignoredFrames","ignoreListLength","useMemo","visible","ignored","frame","push","length","onToggleIgnoreList","dialog","current","height","currentHeight","getBoundingClientRect","onTransitionEnd","removeEventListener","style","addEventListener","div","className","p","span","button","data-expand-ignore-button","onClick","ChevronUpDown","map","frameIndex","CallStackFrame","index","svg","width","viewBox","fill","xmlns","path","fillRule","clipRule","d"],"mappings":";;;;;;;;;;;;;;;IAwHaA,iBAAiB;eAAjBA;;IA/GGC,SAAS;eAATA;;;;uBAR0B;gCACX;AAOxB,SAASA,UAAU,KAA4C;IAA5C,IAAA,EAAEC,MAAM,EAAEC,gBAAgB,EAAkB,GAA5C;IACxB,MAAMC,sBAAsBC,IAAAA,aAAM,EAASC;IAC3C,MAAM,CAACC,kBAAkBC,oBAAoB,GAAGC,IAAAA,eAAQ,EAAC;IAEzD,MAAM,EAAEC,aAAa,EAAEC,aAAa,EAAEC,gBAAgB,EAAE,GAAGC,IAAAA,cAAO,EAAC;QACjE,MAAMC,UAAgC,EAAE;QACxC,MAAMC,UAAgC,EAAE;QAExC,KAAK,MAAMC,SAASd,OAAQ;YAC1B,IAAI,CAACc,MAAMD,OAAO,EAAE;gBAClBD,QAAQG,IAAI,CAACD;YACf;YACA,IAAIA,MAAMD,OAAO,EAAE;gBACjBA,QAAQE,IAAI,CAACD;YACf;QACF;QAEA,OAAO;YACLN,eAAeI;YACfH,eAAeI;YACfH,kBAAkBG,QAAQG,MAAM;QAClC;IACF,GAAG;QAAChB;KAAO;IAEX,SAASiB;QACP,MAAMC,SAASjB,oCAAAA,iBAAkBkB,OAAO;QAExC,IAAI,CAACD,QAAQ;YACX;QACF;QAEA,MAAM,EAAEE,QAAQC,aAAa,EAAE,GAAGH,0BAAAA,OAAQI,qBAAqB;QAE/D,IAAI,CAACpB,oBAAoBiB,OAAO,EAAE;YAChCjB,oBAAoBiB,OAAO,GAAGE;QAChC;QAEA,IAAIhB,kBAAkB;YACpB,SAASkB;gBACPL,OAAOM,mBAAmB,CAAC,iBAAiBD;gBAC5CjB,oBAAoB;YACtB;YACAY,OAAOO,KAAK,CAACL,MAAM,GAAG,AAAC,KAAElB,oBAAoBiB,OAAO,GAAC;YACrDD,OAAOQ,gBAAgB,CAAC,iBAAiBH;QAC3C,OAAO;YACLjB,oBAAoB;QACtB;IACF;IAEA,qBACE,sBAACqB;QAAIC,WAAU;;0BACb,sBAACD;gBAAIC,WAAU;;kCACb,sBAACC;wBAAED,WAAU;;4BAAiC;4BACjC;0CACX,qBAACE;gCAAKF,WAAU;0CACb5B,OAAOgB,MAAM;;;;oBAGjBN,mBAAmB,mBAClB,sBAACqB;wBACCC,6BAA2B3B;wBAC3BuB,WAAU;wBACVK,SAAShB;;4BAELZ,CAAAA,mBAAmB,SAAS,MAAK,IAAE,MAAGK,mBAAiB;0CAC3D,qBAACwB;;;;;YAIN1B,cAAc2B,GAAG,CAAC,CAACrB,OAAOsB,2BACzB,qBAACC,8BAAc;oBAEbvB,OAAOA;oBACPwB,OAAOF;mBAFF,AAAC,wBAAqBA;YAM9B/B,kCACC;0BACGI,cAAc0B,GAAG,CAAC,CAACrB,OAAOsB,2BACzB,qBAACC,8BAAc;wBAEbvB,OAAOA;wBACPwB,OAAOF;uBAFF,AAAC,wBAAqBA;;;;AASzC;AAEA,SAASF;IACP,qBACE,qBAACK;QACCC,OAAM;QACNpB,QAAO;QACPqB,SAAQ;QACRC,MAAK;QACLC,OAAM;kBAEN,cAAA,qBAACC;YACCC,UAAS;YACTC,UAAS;YACTC,GAAE;YACFL,MAAK;;;AAIb;AAEO,MAAM5C,oBAAqB"}