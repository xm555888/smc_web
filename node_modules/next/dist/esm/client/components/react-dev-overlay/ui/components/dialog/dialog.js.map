{"version":3,"sources":["../../../../../../../src/client/components/react-dev-overlay/ui/components/dialog/dialog.tsx"],"sourcesContent":["import * as React from 'react'\nimport { useOnClickOutside } from '../../hooks/use-on-click-outside'\nimport { useMeasureHeight } from '../../hooks/use-measure-height'\n\nexport type DialogProps = {\n  children?: React.ReactNode\n  type: 'error' | 'warning'\n  'aria-labelledby': string\n  'aria-describedby': string\n  className?: string\n  onClose?: () => void\n  dialogResizerRef?: React.RefObject<HTMLDivElement | null>\n}\n\nconst CSS_SELECTORS_TO_EXCLUDE_ON_CLICK_OUTSIDE = [\n  '[data-next-mark]',\n  '[data-issues-open]',\n  '#nextjs-dev-tools-menu',\n  '[data-nextjs-error-overlay-nav]',\n  '[data-info-popover]',\n]\n\nconst Dialog: React.FC<DialogProps> = function Dialog({\n  children,\n  type,\n  className,\n  onClose,\n  'aria-labelledby': ariaLabelledBy,\n  'aria-describedby': ariaDescribedBy,\n  dialogResizerRef,\n  ...props\n}) {\n  const [dialog, setDialog] = React.useState<HTMLDivElement | null>(null)\n  const [role, setRole] = React.useState<string | undefined>(\n    typeof document !== 'undefined' && document.hasFocus()\n      ? 'dialog'\n      : undefined\n  )\n\n  const ref = React.useRef<HTMLDivElement | null>(null)\n  const [height, pristine] = useMeasureHeight(ref)\n\n  const onDialog = React.useCallback((node: HTMLDivElement | null) => {\n    setDialog(node)\n  }, [])\n\n  useOnClickOutside(dialog, CSS_SELECTORS_TO_EXCLUDE_ON_CLICK_OUTSIDE, (e) => {\n    e.preventDefault()\n    return onClose?.()\n  })\n\n  React.useEffect(() => {\n    if (dialog == null) {\n      return\n    }\n\n    function handleFocus() {\n      // safari will force itself as the active application when a background page triggers any sort of autofocus\n      // this is a workaround to only set the dialog role if the document has focus\n      setRole(document.hasFocus() ? 'dialog' : undefined)\n    }\n\n    window.addEventListener('focus', handleFocus)\n    window.addEventListener('blur', handleFocus)\n    return () => {\n      window.removeEventListener('focus', handleFocus)\n      window.removeEventListener('blur', handleFocus)\n    }\n  }, [dialog])\n\n  React.useEffect(() => {\n    const root = dialog?.getRootNode()\n    const activeElement =\n      root instanceof ShadowRoot ? (root?.activeElement as HTMLElement) : null\n\n    // Trap focus within the dialog\n    dialog?.focus()\n\n    return () => {\n      // Blur first to avoid getting stuck, in case `activeElement` is missing\n      dialog?.blur()\n      // Restore focus to the previously active element\n      activeElement?.focus()\n    }\n  }, [dialog])\n\n  return (\n    <div\n      ref={onDialog}\n      data-nextjs-dialog\n      tabIndex={1}\n      role={role}\n      aria-labelledby={ariaLabelledBy}\n      aria-describedby={ariaDescribedBy}\n      aria-modal=\"true\"\n      className={className}\n      onKeyDown={(e) => {\n        if (e.key === 'Escape') {\n          onClose?.()\n        }\n      }}\n      {...props}\n    >\n      <div\n        ref={dialogResizerRef}\n        data-nextjs-dialog-sizer\n        // [x] Don't animate on initial load\n        // [x] No duplicate elements\n        // [x] Responds to content growth\n        style={{\n          height,\n          transition: pristine ? undefined : 'height 250ms var(--timing-swift)',\n        }}\n      >\n        <div ref={ref}>{children}</div>\n      </div>\n    </div>\n  )\n}\n\nexport { Dialog }\n"],"names":["React","useOnClickOutside","useMeasureHeight","CSS_SELECTORS_TO_EXCLUDE_ON_CLICK_OUTSIDE","Dialog","children","type","className","onClose","ariaLabelledBy","ariaDescribedBy","dialogResizerRef","props","dialog","setDialog","useState","role","setRole","document","hasFocus","undefined","ref","useRef","height","pristine","onDialog","useCallback","node","e","preventDefault","useEffect","handleFocus","window","addEventListener","removeEventListener","root","getRootNode","activeElement","ShadowRoot","focus","blur","div","data-nextjs-dialog","tabIndex","aria-labelledby","aria-describedby","aria-modal","onKeyDown","key","data-nextjs-dialog-sizer","style","transition"],"mappings":";AAAA,YAAYA,WAAW,QAAO;AAC9B,SAASC,iBAAiB,QAAQ,mCAAkC;AACpE,SAASC,gBAAgB,QAAQ,iCAAgC;AAYjE,MAAMC,4CAA4C;IAChD;IACA;IACA;IACA;IACA;CACD;AAED,MAAMC,SAAgC,SAASA,OAAO,KASrD;IATqD,IAAA,EACpDC,QAAQ,EACRC,IAAI,EACJC,SAAS,EACTC,OAAO,EACP,mBAAmBC,cAAc,EACjC,oBAAoBC,eAAe,EACnCC,gBAAgB,EAChB,GAAGC,OACJ,GATqD;IAUpD,MAAM,CAACC,QAAQC,UAAU,GAAGd,MAAMe,QAAQ,CAAwB;IAClE,MAAM,CAACC,MAAMC,QAAQ,GAAGjB,MAAMe,QAAQ,CACpC,OAAOG,aAAa,eAAeA,SAASC,QAAQ,KAChD,WACAC;IAGN,MAAMC,MAAMrB,MAAMsB,MAAM,CAAwB;IAChD,MAAM,CAACC,QAAQC,SAAS,GAAGtB,iBAAiBmB;IAE5C,MAAMI,WAAWzB,MAAM0B,WAAW,CAAC,CAACC;QAClCb,UAAUa;IACZ,GAAG,EAAE;IAEL1B,kBAAkBY,QAAQV,2CAA2C,CAACyB;QACpEA,EAAEC,cAAc;QAChB,OAAOrB,2BAAAA;IACT;IAEAR,MAAM8B,SAAS,CAAC;QACd,IAAIjB,UAAU,MAAM;YAClB;QACF;QAEA,SAASkB;YACP,2GAA2G;YAC3G,6EAA6E;YAC7Ed,QAAQC,SAASC,QAAQ,KAAK,WAAWC;QAC3C;QAEAY,OAAOC,gBAAgB,CAAC,SAASF;QACjCC,OAAOC,gBAAgB,CAAC,QAAQF;QAChC,OAAO;YACLC,OAAOE,mBAAmB,CAAC,SAASH;YACpCC,OAAOE,mBAAmB,CAAC,QAAQH;QACrC;IACF,GAAG;QAAClB;KAAO;IAEXb,MAAM8B,SAAS,CAAC;QACd,MAAMK,OAAOtB,0BAAAA,OAAQuB,WAAW;QAChC,MAAMC,gBACJF,gBAAgBG,aAAcH,wBAAAA,KAAME,aAAa,GAAmB;QAEtE,+BAA+B;QAC/BxB,0BAAAA,OAAQ0B,KAAK;QAEb,OAAO;YACL,wEAAwE;YACxE1B,0BAAAA,OAAQ2B,IAAI;YACZ,iDAAiD;YACjDH,iCAAAA,cAAeE,KAAK;QACtB;IACF,GAAG;QAAC1B;KAAO;IAEX,qBACE,KAAC4B;QACCpB,KAAKI;QACLiB,oBAAkB;QAClBC,UAAU;QACV3B,MAAMA;QACN4B,mBAAiBnC;QACjBoC,oBAAkBnC;QAClBoC,cAAW;QACXvC,WAAWA;QACXwC,WAAW,CAACnB;YACV,IAAIA,EAAEoB,GAAG,KAAK,UAAU;gBACtBxC,2BAAAA;YACF;QACF;QACC,GAAGI,KAAK;kBAET,cAAA,KAAC6B;YACCpB,KAAKV;YACLsC,0BAAwB;YACxB,oCAAoC;YACpC,4BAA4B;YAC5B,iCAAiC;YACjCC,OAAO;gBACL3B;gBACA4B,YAAY3B,WAAWJ,YAAY;YACrC;sBAEA,cAAA,KAACqB;gBAAIpB,KAAKA;0BAAMhB;;;;AAIxB;AAEA,SAASD,MAAM,GAAE"}